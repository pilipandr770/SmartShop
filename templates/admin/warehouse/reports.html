{% extends "admin/layout.html" %}

{% block title %}üìà –ó–≤—ñ—Ç–∏ —Å–∫–ª–∞–¥—É{% endblock %}

{% block content %}
<div class="reports-dashboard">
    <div class="page-header" style="margin-bottom: 2rem;">
        <h1>üìà –ó–≤—ñ—Ç–∏ —Å–∫–ª–∞–¥—É</h1>
    </div>

    <!-- –í–∏–±—ñ—Ä –ø–µ—Ä—ñ–æ–¥—É -->
    <div class="period-selector" style="margin-bottom: 2rem; display: flex; gap: 1rem;">
        <a href="{{ url_for('admin_warehouse_reports', period='week') }}" 
           class="btn {% if period == 'week' %}btn-primary{% else %}btn-outline{% endif %}">
            –¢–∏–∂–¥–µ–Ω—å
        </a>
        <a href="{{ url_for('admin_warehouse_reports', period='month') }}" 
           class="btn {% if period == 'month' %}btn-primary{% else %}btn-outline{% endif %}">
            –ú—ñ—Å—è—Ü—å
        </a>
        <a href="{{ url_for('admin_warehouse_reports', period='quarter') }}" 
           class="btn {% if period == 'quarter' %}btn-primary{% else %}btn-outline{% endif %}">
            –ö–≤–∞—Ä—Ç–∞–ª
        </a>
        <a href="{{ url_for('admin_warehouse_reports', period='year') }}" 
           class="btn {% if period == 'year' %}btn-primary{% else %}btn-outline{% endif %}">
            –†—ñ–∫
        </a>
    </div>

    <p class="text-muted" style="margin-bottom: 2rem;">
        üìÖ –ü–µ—Ä—ñ–æ–¥: –∑ <strong>{{ start_date.strftime('%d.%m.%Y') }}</strong>
    </p>

    <div class="reports-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 2rem;">
        <!-- –í—ñ–¥–ø—Ä–∞–≤–∫–∏ -->
        <div class="card">
            <h3>üöö –í—ñ–¥–ø—Ä–∞–≤–∫–∏</h3>
            <div class="report-stats">
                <div class="report-row">
                    <span class="label">–í—Å—å–æ–≥–æ –∑–∞–≤–¥–∞–Ω—å:</span>
                    <span class="value">{{ shipments.total }}</span>
                </div>
                <div class="report-row">
                    <span class="label">–í—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ:</span>
                    <span class="value highlight-blue">{{ shipments.shipped }}</span>
                </div>
                <div class="report-row">
                    <span class="label">–î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ:</span>
                    <span class="value highlight-green">{{ shipments.delivered }}</span>
                </div>
                {% if shipments.total > 0 %}
                <div class="report-row">
                    <span class="label">–í–∏–∫–æ–Ω–∞–Ω–Ω—è:</span>
                    <span class="value">
                        {{ "%.1f"|format(shipments.delivered / shipments.total * 100) }}%
                    </span>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- –ü–æ–ø–æ–≤–Ω–µ–Ω–Ω—è -->
        <div class="card">
            <h3>üì• –ü–æ–ø–æ–≤–Ω–µ–Ω–Ω—è</h3>
            <div class="report-stats">
                <div class="report-row">
                    <span class="label">–í—Å—å–æ–≥–æ –∑–∞–º–æ–≤–ª–µ–Ω—å:</span>
                    <span class="value">{{ replenishments.total }}</span>
                </div>
                <div class="report-row">
                    <span class="label">–û—Ç—Ä–∏–º–∞–Ω–æ:</span>
                    <span class="value highlight-green">{{ replenishments.received }}</span>
                </div>
                <div class="report-row">
                    <span class="label">–°—É–º–∞ –∑–∞–∫—É–ø—ñ–≤–µ–ª—å:</span>
                    <span class="value highlight-blue">{{ "%.2f"|format(replenishments.total_cost) }} UAH</span>
                </div>
            </div>
        </div>

        <!-- –í–∏—Ç—Ä–∞—Ç–∏ -->
        <div class="card">
            <h3>üí∞ –í–∏—Ç—Ä–∞—Ç–∏</h3>
            <div class="report-stats">
                <div class="report-row total">
                    <span class="label">–ó–∞–≥–∞–ª—å–Ω—ñ –≤–∏—Ç—Ä–∞—Ç–∏:</span>
                    <span class="value highlight-red">{{ "%.2f"|format(expenses.total) }} UAH</span>
                </div>
                
                {% for category, amount in expense_by_category.items() %}
                <div class="report-row">
                    <span class="label">
                        {% if category == 'shipping' %}üöö –î–æ—Å—Ç–∞–≤–∫–∞
                        {% elif category == 'packaging' %}üì¶ –ü–∞–∫—É–≤–∞–Ω–Ω—è
                        {% elif category == 'warehouse' %}üè≠ –°–∫–ª–∞–¥
                        {% elif category == 'returns' %}‚Ü©Ô∏è –ü–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è
                        {% elif category == 'salary' %}üë∑ –ó–∞—Ä–ø–ª–∞—Ç–∞
                        {% elif category == 'equipment' %}üîß –û–±–ª–∞–¥–Ω–∞–Ω–Ω—è
                        {% elif category == 'utilities' %}üí° –ö–æ–º—É–Ω–∞–ª—å–Ω—ñ
                        {% else %}üìã {{ category }}{% endif %}
                    </span>
                    <span class="value">{{ "%.2f"|format(amount) }} UAH</span>
                </div>
                {% else %}
                <div class="report-row">
                    <span class="text-muted">–ù–µ–º–∞—î –≤–∏—Ç—Ä–∞—Ç –∑–∞ –ø–µ—Ä—ñ–æ–¥</span>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- –ó–≤–µ–¥–µ–Ω–Ω—è -->
        <div class="card summary-card">
            <h3>üìä –ó–≤–µ–¥–µ–Ω–Ω—è</h3>
            <div class="summary-stats">
                <div class="summary-item">
                    <span class="icon">üì§</span>
                    <span class="number">{{ shipments.shipped }}</span>
                    <span class="label">–í—ñ–¥–ø—Ä–∞–≤–æ–∫</span>
                </div>
                <div class="summary-item">
                    <span class="icon">üì•</span>
                    <span class="number">{{ replenishments.received }}</span>
                    <span class="label">–ü–æ–ø–æ–≤–Ω–µ–Ω—å</span>
                </div>
                <div class="summary-item expense">
                    <span class="icon">üí∏</span>
                    <span class="number">{{ "%.0f"|format(expenses.total) }}</span>
                    <span class="label">–í–∏—Ç—Ä–∞—Ç (UAH)</span>
                </div>
            </div>
        </div>
    </div>

    <!-- –®–≤–∏–¥–∫—ñ –ø–æ—Å–∏–ª–∞–Ω–Ω—è -->
    <div class="quick-links" style="margin-top: 2rem; display: flex; gap: 1rem; flex-wrap: wrap;">
        <a href="{{ url_for('admin_warehouse') }}" class="btn btn-outline">üì¶ –ó–∞–≤–¥–∞–Ω–Ω—è</a>
        <a href="{{ url_for('admin_warehouse_stock') }}" class="btn btn-outline">üìä –ó–∞–ª–∏—à–∫–∏</a>
        <a href="{{ url_for('admin_warehouse_replenishment') }}" class="btn btn-outline">üì• –ü–æ–ø–æ–≤–Ω–µ–Ω–Ω—è</a>
        <a href="{{ url_for('admin_warehouse_expenses') }}" class="btn btn-outline">üí∞ –í–∏—Ç—Ä–∞—Ç–∏</a>
    </div>
</div>

<style>
.card {
    background: white;
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}
.card h3 {
    margin: 0 0 1rem 0;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid #eee;
}

.report-stats { display: flex; flex-direction: column; gap: 0.75rem; }
.report-row {
    display: flex;
    justify-content: space-between;
    padding: 0.5rem 0;
    border-bottom: 1px solid #f5f5f5;
}
.report-row:last-child { border-bottom: none; }
.report-row.total { 
    background: #f8f9fa; 
    margin: -0.5rem -1rem 0.5rem -1rem;
    padding: 1rem;
    border-radius: 8px;
}
.report-row .label { color: #666; }
.report-row .value { font-weight: bold; font-size: 1.1rem; }

.highlight-blue { color: #007bff; }
.highlight-green { color: #28a745; }
.highlight-red { color: #dc3545; }

.summary-card .summary-stats {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1rem;
    text-align: center;
}
.summary-item {
    padding: 1rem;
    background: #f8f9fa;
    border-radius: 8px;
}
.summary-item .icon { font-size: 2rem; display: block; }
.summary-item .number { font-size: 2rem; font-weight: bold; display: block; color: #007bff; }
.summary-item .label { color: #666; font-size: 0.85rem; }
.summary-item.expense .number { color: #dc3545; }

.btn-outline { background: transparent; border: 1px solid #ddd; color: #333; }
.btn-outline:hover { background: #f5f5f5; }
</style>
{% endblock %}
