{% extends "admin/layout.html" %}

{% block title %}üí∞ –í–∏—Ç—Ä–∞—Ç–∏ —Å–∫–ª–∞–¥—É{% endblock %}

{% block content %}
<div class="expenses-dashboard">
    <div class="page-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
        <h1>üí∞ –í–∏—Ç—Ä–∞—Ç–∏ —Å–∫–ª–∞–¥—É</h1>
        <a href="{{ url_for('admin_warehouse_expenses_add') }}" class="btn btn-success">
            ‚ûï –î–æ–¥–∞—Ç–∏ –≤–∏—Ç—Ä–∞—Ç—É
        </a>
    </div>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞ –º—ñ—Å—è—Ü—å -->
    <div class="card" style="margin-bottom: 2rem;">
        <h3>üìä –í–∏—Ç—Ä–∞—Ç–∏ –∑–∞ –ø–æ—Ç–æ—á–Ω–∏–π –º—ñ—Å—è—Ü—å</h3>
        <div class="stats-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem;">
            {% for category, amount in stats_by_category.items() %}
            <div class="expense-stat">
                <span class="category-icon">
                    {% if category == 'shipping' %}üöö
                    {% elif category == 'packaging' %}üì¶
                    {% elif category == 'warehouse' %}üè≠
                    {% elif category == 'returns' %}‚Ü©Ô∏è
                    {% elif category == 'salary' %}üë∑
                    {% elif category == 'equipment' %}üîß
                    {% elif category == 'utilities' %}üí°
                    {% else %}üìã{% endif %}
                </span>
                <span class="amount">{{ "%.2f"|format(amount) }}</span>
                <span class="label">{{ category }}</span>
            </div>
            {% else %}
            <p class="text-muted">–ù–µ–º–∞—î –≤–∏—Ç—Ä–∞—Ç –∑–∞ —Ü–µ–π –º—ñ—Å—è—Ü—å</p>
            {% endfor %}
        </div>
        <div style="margin-top: 1rem; padding-top: 1rem; border-top: 2px solid #eee; text-align: right;">
            <strong style="font-size: 1.5rem;">–í—Å—å–æ–≥–æ: {{ "%.2f"|format(total_monthly) }} UAH</strong>
        </div>
    </div>

    <!-- –§—ñ–ª—å—Ç—Ä–∏ -->
    <div class="card" style="margin-bottom: 1.5rem;">
        <form method="GET" style="display: flex; gap: 1rem; flex-wrap: wrap; align-items: end;">
            <div class="form-group" style="margin: 0;">
                <label>–ö–∞—Ç–µ–≥–æ—Ä—ñ—è:</label>
                <select name="category" class="form-control">
                    <option value="">–í—Å—ñ</option>
                    {% for cat in expense_categories %}
                    <option value="{{ cat.value }}" {% if category_filter == cat.value %}selected{% endif %}>
                        {{ cat.value }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            
            <div class="form-group" style="margin: 0;">
                <label>–í—ñ–¥:</label>
                <input type="date" name="date_from" value="{{ date_from }}" class="form-control">
            </div>
            
            <div class="form-group" style="margin: 0;">
                <label>–î–æ:</label>
                <input type="date" name="date_to" value="{{ date_to }}" class="form-control">
            </div>
            
            <button type="submit" class="btn btn-primary">üîç –§—ñ–ª—å—Ç—Ä—É–≤–∞—Ç–∏</button>
            <a href="{{ url_for('admin_warehouse_expenses') }}" class="btn btn-outline">–°–∫–∏–Ω—É—Ç–∏</a>
        </form>
    </div>

    <!-- –¢–∞–±–ª–∏—Ü—è –≤–∏—Ç—Ä–∞—Ç -->
    <div class="table-responsive">
        <table class="admin-table">
            <thead>
                <tr>
                    <th>–î–∞—Ç–∞</th>
                    <th>–ö–∞—Ç–µ–≥–æ—Ä—ñ—è</th>
                    <th>–û–ø–∏—Å</th>
                    <th>–°—É–º–∞</th>
                    <th>‚Ññ –ß–µ–∫—É</th>
                    <th>–ü—Ä–∏–º—ñ—Ç–∫–∏</th>
                </tr>
            </thead>
            <tbody>
                {% for expense in expenses %}
                <tr>
                    <td>{{ expense.expense_date.strftime('%d.%m.%Y') }}</td>
                    <td>
                        <span class="category-badge category-{{ expense.category }}">
                            {% if expense.category == 'shipping' %}üöö –î–æ—Å—Ç–∞–≤–∫–∞
                            {% elif expense.category == 'packaging' %}üì¶ –ü–∞–∫—É–≤–∞–Ω–Ω—è
                            {% elif expense.category == 'warehouse' %}üè≠ –°–∫–ª–∞–¥
                            {% elif expense.category == 'returns' %}‚Ü©Ô∏è –ü–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è
                            {% elif expense.category == 'salary' %}üë∑ –ó–∞—Ä–ø–ª–∞—Ç–∞
                            {% elif expense.category == 'equipment' %}üîß –û–±–ª–∞–¥–Ω–∞–Ω–Ω—è
                            {% elif expense.category == 'utilities' %}üí° –ö–æ–º—É–Ω–∞–ª—å–Ω—ñ
                            {% else %}üìã –Ü–Ω—à–µ{% endif %}
                        </span>
                    </td>
                    <td>{{ expense.description }}</td>
                    <td><strong>{{ "%.2f"|format(expense.amount) }}</strong> {{ expense.currency }}</td>
                    <td><code>{{ expense.receipt_number or '‚Äî' }}</code></td>
                    <td>{{ expense.notes or '‚Äî' }}</td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="6" class="text-center text-muted">
                        <p style="padding: 2rem;">
                            üì≠ –ù–µ–º–∞—î –≤–∏—Ç—Ä–∞—Ç –∑–∞ –æ–±—Ä–∞–Ω–∏–π –ø–µ—Ä—ñ–æ–¥
                        </p>
                        <a href="{{ url_for('admin_warehouse_expenses_add') }}" class="btn btn-success">
                            ‚ûï –î–æ–¥–∞—Ç–∏ –ø–µ—Ä—à—É –≤–∏—Ç—Ä–∞—Ç—É
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- –ü–∞–≥—ñ–Ω–∞—Ü—ñ—è -->
    {% if total_pages > 1 %}
    <div class="pagination" style="margin-top: 1.5rem; display: flex; justify-content: center; gap: 0.5rem;">
        {% if page > 1 %}
        <a href="{{ url_for('admin_warehouse_expenses', page=page-1, category=category_filter, date_from=date_from, date_to=date_to) }}" class="btn btn-sm btn-outline">‚Üê –ù–∞–∑–∞–¥</a>
        {% endif %}
        
        <span class="btn btn-sm disabled">{{ page }} –∑ {{ total_pages }}</span>
        
        {% if page < total_pages %}
        <a href="{{ url_for('admin_warehouse_expenses', page=page+1, category=category_filter, date_from=date_from, date_to=date_to) }}" class="btn btn-sm btn-outline">–î–∞–ª—ñ ‚Üí</a>
        {% endif %}
    </div>
    {% endif %}
</div>

<style>
.card {
    background: white;
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}
.card h3 {
    margin: 0 0 1rem 0;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid #eee;
}

.expense-stat {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 1rem;
    background: #f8f9fa;
    border-radius: 8px;
}
.expense-stat .category-icon { font-size: 2rem; }
.expense-stat .amount { font-size: 1.5rem; font-weight: bold; color: #dc3545; }
.expense-stat .label { color: #666; font-size: 0.85rem; }

.category-badge {
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.85rem;
    white-space: nowrap;
}
.category-shipping { background: #e3f2fd; color: #1565c0; }
.category-packaging { background: #fce4ec; color: #c2185b; }
.category-warehouse { background: #f3e5f5; color: #7b1fa2; }
.category-returns { background: #fff3e0; color: #ef6c00; }
.category-salary { background: #e8f5e9; color: #2e7d32; }
.category-equipment { background: #fff8e1; color: #f57f17; }
.category-utilities { background: #e0f7fa; color: #00838f; }

.form-group label { display: block; margin-bottom: 0.25rem; font-weight: 500; font-size: 0.85rem; }
.form-control { padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px; }

.btn-outline { background: transparent; border: 1px solid #ddd; color: #333; }
.btn-outline:hover { background: #f5f5f5; }
</style>
{% endblock %}
