{% extends "admin/layout.html" %}

{% block title %}üì¶ –°–∫–ª–∞–¥ - –ó–∞–≤–¥–∞–Ω–Ω—è{% endblock %}

{% block content %}
<div class="warehouse-dashboard">
    <div class="page-header">
        <h1>üì¶ –°–∫–ª–∞–¥ - –ó–∞–≤–¥–∞–Ω–Ω—è –Ω–∞ –≤—ñ–¥–ø—Ä–∞–≤–∫—É</h1>
    </div>

    <!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="stats-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
        <div class="stat-card pending">
            <div class="stat-icon">‚è≥</div>
            <div class="stat-info">
                <span class="stat-value">{{ stats.pending }}</span>
                <span class="stat-label">–û—á—ñ–∫—É—é—Ç—å</span>
            </div>
        </div>
        <div class="stat-card processing">
            <div class="stat-icon">üîÑ</div>
            <div class="stat-info">
                <span class="stat-value">{{ stats.processing }}</span>
                <span class="stat-label">–í —Ä–æ–±–æ—Ç—ñ</span>
            </div>
        </div>
        <div class="stat-card packed">
            <div class="stat-icon">üì¶</div>
            <div class="stat-info">
                <span class="stat-value">{{ stats.packed }}</span>
                <span class="stat-label">–ó–∞–ø–∞–∫–æ–≤–∞–Ω–æ</span>
            </div>
        </div>
        <div class="stat-card shipped">
            <div class="stat-icon">üöö</div>
            <div class="stat-info">
                <span class="stat-value">{{ stats.shipped_today }}</span>
                <span class="stat-label">–í—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ —Å—å–æ–≥–æ–¥–Ω—ñ</span>
            </div>
        </div>
    </div>

    <!-- –§—ñ–ª—å—Ç—Ä–∏ -->
    <div class="filters-bar" style="margin-bottom: 1.5rem; display: flex; gap: 1rem; flex-wrap: wrap;">
        <a href="{{ url_for('admin_warehouse') }}" 
           class="btn {% if not status_filter %}btn-primary{% else %}btn-outline{% endif %}">
            –ê–∫—Ç–∏–≤–Ω—ñ
        </a>
        <a href="{{ url_for('admin_warehouse', status='pending') }}" 
           class="btn {% if status_filter == 'pending' %}btn-primary{% else %}btn-outline{% endif %}">
            ‚è≥ –û—á—ñ–∫—É—é—Ç—å
        </a>
        <a href="{{ url_for('admin_warehouse', status='processing') }}" 
           class="btn {% if status_filter == 'processing' %}btn-primary{% else %}btn-outline{% endif %}">
            üîÑ –í —Ä–æ–±–æ—Ç—ñ
        </a>
        <a href="{{ url_for('admin_warehouse', status='packed') }}" 
           class="btn {% if status_filter == 'packed' %}btn-primary{% else %}btn-outline{% endif %}">
            üì¶ –ó–∞–ø–∞–∫–æ–≤–∞–Ω–æ
        </a>
        <a href="{{ url_for('admin_warehouse', status='shipped') }}" 
           class="btn {% if status_filter == 'shipped' %}btn-primary{% else %}btn-outline{% endif %}">
            üöö –í—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ
        </a>
        <a href="{{ url_for('admin_warehouse', status='delivered') }}" 
           class="btn {% if status_filter == 'delivered' %}btn-primary{% else %}btn-outline{% endif %}">
            ‚úîÔ∏è –î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ
        </a>
    </div>

    <!-- –¢–∞–±–ª–∏—Ü—è –∑–∞–≤–¥–∞–Ω—å -->
    <div class="table-responsive">
        <table class="admin-table">
            <thead>
                <tr>
                    <th>‚Ññ –ó–∞–≤–¥–∞–Ω–Ω—è</th>
                    <th>–ó–∞–º–æ–≤–ª–µ–Ω–Ω—è</th>
                    <th>–ö–ª—ñ—î–Ω—Ç</th>
                    <th>–ê–¥—Ä–µ—Å–∞</th>
                    <th>–ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç</th>
                    <th>–°—Ç–∞—Ç—É—Å</th>
                    <th>–°—Ç–≤–æ—Ä–µ–Ω–æ</th>
                    <th>–î—ñ—ó</th>
                </tr>
            </thead>
            <tbody>
                {% for task in tasks %}
                <tr class="priority-{{ task.priority }}">
                    <td>
                        <strong>{{ task.task_number or '#' ~ task.id }}</strong>
                        {% if task.is_b2b %}
                        <span class="badge badge-info">B2B</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if task.order %}
                        <a href="{{ url_for('admin_order_detail', id=task.order_id) }}">
                            #{{ task.order.id }}
                        </a>
                        {% else %}
                        #{{ task.order_id }}
                        {% endif %}
                    </td>
                    <td>
                        {{ task.customer_name or '‚Äî' }}<br>
                        <small class="text-muted">{{ task.customer_phone or '' }}</small>
                    </td>
                    <td>
                        <small>{{ task.shipping_address[:50] }}{% if task.shipping_address|length > 50 %}...{% endif %}</small>
                    </td>
                    <td>
                        {% if task.priority == 1 %}
                        <span class="badge badge-danger">üî¥ –¢–µ—Ä–º—ñ–Ω–æ–≤–æ</span>
                        {% elif task.priority == 2 %}
                        <span class="badge badge-warning">üü° –í–∏—Å–æ–∫–∏–π</span>
                        {% else %}
                        <span class="badge badge-secondary">‚ö™ –ó–≤–∏—á–∞–π–Ω–∏–π</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if task.status == 'pending' %}
                        <span class="badge badge-secondary">‚è≥ –û—á—ñ–∫—É—î</span>
                        {% elif task.status == 'processing' %}
                        <span class="badge badge-primary">üîÑ –í —Ä–æ–±–æ—Ç—ñ</span>
                        {% elif task.status == 'packed' %}
                        <span class="badge badge-info">üì¶ –ó–∞–ø–∞–∫–æ–≤–∞–Ω–æ</span>
                        {% elif task.status == 'ready' %}
                        <span class="badge badge-success">‚úÖ –ì–æ—Ç–æ–≤–æ</span>
                        {% elif task.status == 'shipped' %}
                        <span class="badge badge-warning">üöö –í—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ</span>
                        {% elif task.status == 'delivered' %}
                        <span class="badge badge-success">‚úîÔ∏è –î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ</span>
                        {% elif task.status == 'cancelled' %}
                        <span class="badge badge-danger">‚ùå –°–∫–∞—Å–æ–≤–∞–Ω–æ</span>
                        {% endif %}
                    </td>
                    <td>
                        <small>{{ task.created_at.strftime('%d.%m.%Y %H:%M') }}</small>
                    </td>
                    <td>
                        <a href="{{ url_for('admin_warehouse_task', id=task.id) }}" class="btn btn-sm btn-primary">
                            üëÅÔ∏è –î–µ—Ç–∞–ª—ñ
                        </a>
                    </td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="8" class="text-center text-muted">
                        <p style="padding: 2rem;">
                            üì≠ –ù–µ–º–∞—î –∑–∞–≤–¥–∞–Ω—å
                            {% if status_filter %}–∑ —Ç–∞–∫–∏–º —Å—Ç–∞—Ç—É—Å–æ–º{% endif %}
                        </p>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- –ü–∞–≥—ñ–Ω–∞—Ü—ñ—è -->
    {% if total_pages > 1 %}
    <div class="pagination" style="margin-top: 1.5rem; display: flex; justify-content: center; gap: 0.5rem;">
        {% if page > 1 %}
        <a href="{{ url_for('admin_warehouse', page=page-1, status=status_filter) }}" class="btn btn-sm btn-outline">‚Üê –ù–∞–∑–∞–¥</a>
        {% endif %}
        
        <span class="btn btn-sm disabled">{{ page }} –∑ {{ total_pages }}</span>
        
        {% if page < total_pages %}
        <a href="{{ url_for('admin_warehouse', page=page+1, status=status_filter) }}" class="btn btn-sm btn-outline">–î–∞–ª—ñ ‚Üí</a>
        {% endif %}
    </div>
    {% endif %}
</div>

<style>
.stat-card {
    background: white;
    border-radius: 12px;
    padding: 1.5rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}
.stat-card .stat-icon {
    font-size: 2rem;
}
.stat-card .stat-value {
    display: block;
    font-size: 2rem;
    font-weight: bold;
}
.stat-card .stat-label {
    color: #666;
}
.stat-card.pending { border-left: 4px solid #ffc107; }
.stat-card.processing { border-left: 4px solid #17a2b8; }
.stat-card.packed { border-left: 4px solid #6c5ce7; }
.stat-card.shipped { border-left: 4px solid #28a745; }

.priority-1 { background: rgba(255,0,0,0.05); }
.priority-2 { background: rgba(255,193,7,0.05); }

.badge {
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.75rem;
    font-weight: 500;
}
.badge-primary { background: #007bff; color: white; }
.badge-secondary { background: #6c757d; color: white; }
.badge-success { background: #28a745; color: white; }
.badge-danger { background: #dc3545; color: white; }
.badge-warning { background: #ffc107; color: #333; }
.badge-info { background: #17a2b8; color: white; }

.btn-outline {
    background: transparent;
    border: 1px solid #ddd;
    color: #333;
}
.btn-outline:hover {
    background: #f5f5f5;
}
</style>
{% endblock %}
