{% extends 'admin/layout.html' %}
{% block title %}{{ '–†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è' if post else '–ù–æ–≤–∞ —Å—Ç–∞—Ç—Ç—è' }} - –ê–¥–º—ñ–Ω –ø–∞–Ω–µ–ª—å{% endblock %}
{% block content %}
<div class="page-header">
    <div style="display:flex;justify-content:space-between;align-items:center;">
        <div>
            <a href="{{ url_for('admin_blog') }}" class="back-link">‚Üê –ù–∞–∑–∞–¥ –¥–æ –±–ª–æ–≥—É</a>
            <h1>{{ '–†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è —Å—Ç–∞—Ç—Ç—ñ' if post else '–ù–æ–≤–∞ —Å—Ç–∞—Ç—Ç—è' }}</h1>
        </div>
        {% if post and post.status == 'draft' %}
        <button type="button" class="btn btn-accent" onclick="generateWithAI()">ü§ñ –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ AI</button>
        {% endif %}
    </div>
</div>

<form method="post" id="postForm">
    <div class="editor-layout">
        <!-- –û—Å–Ω–æ–≤–Ω–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
        <div class="editor-main">
            <div class="card">
                <!-- Language Tabs -->
                <div class="lang-tabs">
                    <button type="button" class="lang-tab active" data-lang="uk">üá∫üá¶ –£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</button>
                    <button type="button" class="lang-tab" data-lang="en">üá¨üáß English</button>
                    <button type="button" class="lang-tab" data-lang="de">üá©üá™ Deutsch</button>
                </div>
                
                <div class="form-section">
                    <div class="form-group">
                        <label for="slug">URL (slug)</label>
                        <div class="slug-input">
                            <span class="slug-prefix">/blog/</span>
                            <input type="text" id="slug" name="slug" required
                                   value="{{ post.slug if post else '' }}" 
                                   placeholder="url-statyi">
                        </div>
                    </div>
                    
                    <!-- Ukrainian content -->
                    <div class="lang-content" data-lang="uk">
                        <div class="form-group">
                            <label for="title">–ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç–∞—Ç—Ç—ñ (UK)</label>
                            <input type="text" id="title" name="title" required
                                   value="{{ post.title if post else '' }}" 
                                   placeholder="–í–≤–µ–¥—ñ—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫ —Å—Ç–∞—Ç—Ç—ñ..."
                                   oninput="generateSlug()">
                        </div>
                        
                        <div class="form-group">
                            <label for="excerpt">–ö–æ—Ä–æ—Ç–∫–∏–π –æ–ø–∏—Å (UK)</label>
                            <textarea id="excerpt" name="excerpt" rows="3" 
                                      placeholder="–ö–æ—Ä–æ—Ç–∫–∏–π –æ–ø–∏—Å –¥–ª—è –∫–∞—Ä—Ç–∫–∏ (–¥–æ 200 —Å–∏–º–≤–æ–ª—ñ–≤)...">{{ post.excerpt if post else '' }}</textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="content">–ü–æ–≤–Ω–∏–π —Ç–µ–∫—Å—Ç —Å—Ç–∞—Ç—Ç—ñ (UK)</label>
                            <textarea id="content" name="content" rows="15" 
                                      placeholder="–ù–∞–ø–∏—à—ñ—Ç—å —Å—Ç–∞—Ç—Ç—é —Ç—É—Ç... –ü—ñ–¥—Ç—Ä–∏–º—É—î—Ç—å—Å—è HTML —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è.">{{ post.content if post else '' }}</textarea>
                            <small class="form-hint">üí° –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ &lt;h2&gt;, &lt;h3&gt; –¥–ª—è –ø—ñ–¥–∑–∞–≥–æ–ª–æ–≤–∫—ñ–≤</small>
                        </div>
                    </div>
                    
                    <!-- English content -->
                    <div class="lang-content" data-lang="en" style="display:none;">
                        <div class="form-group">
                            <label for="title_en">Article Title (EN)</label>
                            <input type="text" id="title_en" name="title_en"
                                   value="{{ post.title_en if post else '' }}" 
                                   placeholder="Enter article title...">
                        </div>
                        
                        <div class="form-group">
                            <label for="excerpt_en">Short Description (EN)</label>
                            <textarea id="excerpt_en" name="excerpt_en" rows="3" 
                                      placeholder="Short description for card (up to 200 chars)...">{{ post.excerpt_en if post else '' }}</textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="content_en">Full Article Text (EN)</label>
                            <textarea id="content_en" name="content_en" rows="15" 
                                      placeholder="Write article here... HTML formatting supported.">{{ post.content_en if post else '' }}</textarea>
                        </div>
                    </div>
                    
                    <!-- German content -->
                    <div class="lang-content" data-lang="de" style="display:none;">
                        <div class="form-group">
                            <label for="title_de">Artikeltitel (DE)</label>
                            <input type="text" id="title_de" name="title_de"
                                   value="{{ post.title_de if post else '' }}" 
                                   placeholder="Geben Sie den Artikeltitel ein...">
                        </div>
                        
                        <div class="form-group">
                            <label for="excerpt_de">Kurzbeschreibung (DE)</label>
                            <textarea id="excerpt_de" name="excerpt_de" rows="3" 
                                      placeholder="Kurzbeschreibung f√ºr Karte (bis 200 Zeichen)...">{{ post.excerpt_de if post else '' }}</textarea>
                        </div>
                        
                        <div class="form-group">
                            <label for="content_de">Vollst√§ndiger Artikeltext (DE)</label>
                            <textarea id="content_de" name="content_de" rows="15" 
                                      placeholder="Schreiben Sie hier den Artikel... HTML-Formatierung unterst√ºtzt.">{{ post.content_de if post else '' }}</textarea>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- SEO –±–ª–æ–∫ -->
            <div class="card" style="margin-top: 1rem;">
                <div class="card-header">
                    <h3>üîç SEO –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</h3>
                </div>
                <div class="form-section">
                    <div class="form-group">
                        <label for="meta_title">Meta Title</label>
                        <input type="text" id="meta_title" name="meta_title" maxlength="100"
                               value="{{ post.meta_title if post else '' }}" 
                               placeholder="SEO –∑–∞–≥–æ–ª–æ–≤–æ–∫ (–¥–æ 60 —Å–∏–º–≤–æ–ª—ñ–≤)">
                        <div class="char-counter"><span id="meta-title-count">0</span>/60</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="meta_description">Meta Description</label>
                        <textarea id="meta_description" name="meta_description" rows="2" maxlength="200"
                                  placeholder="SEO –æ–ø–∏—Å (–¥–æ 160 —Å–∏–º–≤–æ–ª—ñ–≤)">{{ post.meta_description if post else '' }}</textarea>
                        <div class="char-counter"><span id="meta-desc-count">0</span>/160</div>
                    </div>
                    
                    <div class="form-group">
                        <label for="meta_keywords">–ö–ª—é—á–æ–≤—ñ —Å–ª–æ–≤–∞</label>
                        <input type="text" id="meta_keywords" name="meta_keywords"
                               value="{{ post.meta_keywords if post else '' }}" 
                               placeholder="–∫–ª—é—á1, –∫–ª—é—á2, –∫–ª—é—á3...">
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Sidebar -->
        <div class="editor-sidebar">
            <!-- –ü—É–±–ª—ñ–∫–∞—Ü—ñ—è -->
            <div class="card">
                <div class="card-header">
                    <h3>üì§ –ü—É–±–ª—ñ–∫–∞—Ü—ñ—è</h3>
                </div>
                <div class="form-section">
                    <div class="form-group">
                        <label for="status">–°—Ç–∞—Ç—É—Å</label>
                        <select id="status" name="status">
                            <option value="draft" {{ 'selected' if (post and post.status == 'draft') or not post else '' }}>üìù –ß–µ—Ä–Ω–µ—Ç–∫–∞</option>
                            <option value="scheduled" {{ 'selected' if post and post.status == 'scheduled' else '' }}>üïê –ó–∞–ø–ª–∞–Ω–æ–≤–∞–Ω–∞</option>
                            <option value="published" {{ 'selected' if post and post.status == 'published' else '' }}>‚úì –û–ø—É–±–ª—ñ–∫–æ–≤–∞–Ω–∞</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="publish_date">–î–∞—Ç–∞ –ø—É–±–ª—ñ–∫–∞—Ü—ñ—ó</label>
                        <input type="datetime-local" id="publish_date" name="publish_date"
                               value="{{ post.publish_date.strftime('%Y-%m-%dT%H:%M') if post and post.publish_date else '' }}">
                    </div>
                    
                    <div class="form-group">
                        <label for="author">–ê–≤—Ç–æ—Ä</label>
                        <input type="text" id="author" name="author"
                               value="{{ post.author if post else 'AI' }}" placeholder="AI">
                    </div>
                    
                    <div class="form-actions">
                        <button type="submit" name="action" value="save" class="btn btn-secondary">üíæ –ó–±–µ—Ä–µ–≥—Ç–∏</button>
                        <button type="submit" name="action" value="publish" class="btn btn-primary">üì§ –û–ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏</button>
                    </div>
                    
                    {% if post and post.id %}
                    <!-- –ê–≤—Ç–æ–ø–µ—Ä–µ–∫–ª–∞–¥ -->
                    <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid rgba(148, 163, 184, 0.3);">
                        <button type="button" class="btn btn-accent btn-full" onclick="translatePost()">
                            üåê –ê–≤—Ç–æ–ø–µ—Ä–µ–∫–ª–∞–¥ (EN + DE)
                        </button>
                        <div id="translateProgress" class="ai-progress" style="display:none;">
                            <div class="spinner"></div>
                            <span>–ü–µ—Ä–µ–∫–ª–∞–¥...</span>
                        </div>
                        <div id="translateResult" style="display:none; margin-top: 0.5rem; padding: 0.75rem; background: rgba(34, 197, 94, 0.1); border-radius: 0.5rem; font-size: 0.85rem;">
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
            
            <!-- –ú–µ–¥—ñ–∞ -->
            <div class="card">
                <div class="card-header">
                    <h3>üñº –ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è</h3>
                </div>
                <div class="form-section">
                    <div class="form-group">
                        <label for="featured_image">URL –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è</label>
                        <input type="text" id="featured_image" name="featured_image"
                               value="{{ post.featured_image if post else '' }}" 
                               placeholder="https://...">
                    </div>
                    <div class="image-preview" id="imagePreview">
                        {% if post and post.featured_image %}
                        <img src="{{ post.featured_image }}" alt="Preview">
                        {% else %}
                        <div class="preview-placeholder">üñº –ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –ø–µ—Ä–µ–≥–ª—è–¥</div>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- –ö–∞—Ç–µ–≥–æ—Ä—ñ—è —Ç–∞ —Ç–µ–≥–∏ -->
            <div class="card">
                <div class="card-header">
                    <h3>üè∑ –ö–∞—Ç–µ–≥–æ—Ä—ñ—è —Ç–∞ —Ç–µ–≥–∏</h3>
                </div>
                <div class="form-section">
                    <div class="form-group">
                        <label for="category">–ö–∞—Ç–µ–≥–æ—Ä—ñ—è</label>
                        <input type="text" id="category" name="category"
                               value="{{ post.category if post else '' }}" 
                               placeholder="–û–≥–ª—è–¥–∏, –ü–æ—Ä–∞–¥–∏, –ù–æ–≤–∏–Ω–∏...">
                    </div>
                    
                    <div class="form-group">
                        <label for="tags">–¢–µ–≥–∏</label>
                        <input type="text" id="tags" name="tags"
                               value="{{ post.tags if post else '' }}" 
                               placeholder="—Ç–µ–≥1, —Ç–µ–≥2, —Ç–µ–≥3...">
                        <small class="form-hint">–ß–µ—Ä–µ–∑ –∫–æ–º—É</small>
                    </div>
                </div>
            </div>
            
            <!-- AI –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è -->
            {% if not post or post.status == 'draft' %}
            <div class="card ai-card">
                <div class="card-header">
                    <h3>ü§ñ AI –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è</h3>
                </div>
                <div class="form-section">
                    <div class="form-group">
                        <label for="ai_topic">–¢–µ–º–∞ –¥–ª—è AI</label>
                        <input type="text" id="ai_topic" name="ai_topic"
                               value="{{ post.ai_topic if post else '' }}" 
                               placeholder="–û–ø–∏—à—ñ—Ç—å —Ç–µ–º—É —Å—Ç–∞—Ç—Ç—ñ...">
                    </div>
                    <button type="button" class="btn btn-accent btn-full" onclick="generateWithAI()">
                        ü§ñ –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ —Å—Ç–∞—Ç—Ç—é
                    </button>
                    <div id="aiProgress" class="ai-progress" style="display:none;">
                        <div class="spinner"></div>
                        <span>–ì–µ–Ω–µ—Ä–∞—Ü—ñ—è...</span>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</form>

<style>
.back-link {
    color: var(--text-muted);
    text-decoration: none;
    font-size: 0.85rem;
}

.back-link:hover {
    color: var(--accent);
}

/* Language Tabs */
.lang-tabs {
    display: flex;
    gap: 0;
    border-bottom: 1px solid rgba(148, 163, 184, 0.3);
    padding: 0 1.25rem;
}

.lang-tab {
    padding: 0.75rem 1.25rem;
    background: none;
    border: none;
    color: var(--text-muted);
    cursor: pointer;
    font-size: 0.9rem;
    border-bottom: 2px solid transparent;
    margin-bottom: -1px;
    transition: all 0.2s;
}

.lang-tab:hover {
    color: var(--text-main);
}

.lang-tab.active {
    color: var(--accent);
    border-bottom-color: var(--accent);
}

.lang-content {
    animation: fadeIn 0.2s ease;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

.editor-layout {
    display: grid;
    grid-template-columns: 1fr 320px;
    gap: 1.5rem;
    align-items: start;
}

.form-section {
    padding: 1.25rem;
}

.form-group {
    margin-bottom: 1rem;
}

.form-group:last-child {
    margin-bottom: 0;
}

.slug-input {
    display: flex;
    align-items: center;
}

.slug-prefix {
    padding: 0.6rem 0.75rem;
    background: rgba(148, 163, 184, 0.15);
    border: 1px solid rgba(148, 163, 184, 0.3);
    border-right: none;
    border-radius: 0.5rem 0 0 0.5rem;
    color: var(--text-muted);
    font-size: 0.9rem;
}

.slug-input input {
    border-radius: 0 0.5rem 0.5rem 0;
}

.char-counter {
    text-align: right;
    font-size: 0.75rem;
    color: var(--text-muted);
    margin-top: 0.25rem;
}

.form-actions {
    display: flex;
    gap: 0.5rem;
    margin-top: 1rem;
}

.btn-full {
    width: 100%;
}

.image-preview {
    margin-top: 0.5rem;
    border-radius: 0.5rem;
    overflow: hidden;
    border: 1px solid rgba(148, 163, 184, 0.3);
    min-height: 120px;
}

.image-preview img {
    width: 100%;
    height: auto;
    display: block;
}

.preview-placeholder {
    height: 120px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--text-muted);
    background: rgba(148, 163, 184, 0.1);
}

.ai-card {
    border-color: rgba(168, 85, 247, 0.3);
}

.ai-card .card-header {
    background: rgba(168, 85, 247, 0.1);
}

.btn-accent {
    background: linear-gradient(135deg, #a855f7, #8b5cf6);
    color: white;
}

.btn-accent:hover {
    filter: brightness(1.1);
}

.ai-progress {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 1rem;
    background: rgba(168, 85, 247, 0.1);
    border-radius: 0.5rem;
    margin-top: 0.5rem;
    color: #a855f7;
}

.spinner {
    width: 20px;
    height: 20px;
    border: 2px solid rgba(168, 85, 247, 0.3);
    border-top-color: #a855f7;
    border-radius: 50%;
    animation: spin 1s linear infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

@media (max-width: 1024px) {
    .editor-layout {
        grid-template-columns: 1fr;
    }
}
</style>

<script>
// –ì–µ–Ω–µ—Ä–∞—Ü—ñ—è slug
function generateSlug() {
    const title = document.getElementById('title').value;
    const slug = transliterate(title);
    document.getElementById('slug').value = slug;
}

function transliterate(text) {
    const map = {
        '–∞': 'a', '–±': 'b', '–≤': 'v', '–≥': 'h', '“ë': 'g', '–¥': 'd', '–µ': 'e',
        '—î': 'ye', '–∂': 'zh', '–∑': 'z', '–∏': 'y', '—ñ': 'i', '—ó': 'yi', '–π': 'y',
        '–∫': 'k', '–ª': 'l', '–º': 'm', '–Ω': 'n', '–æ': 'o', '–ø': 'p', '—Ä': 'r',
        '—Å': 's', '—Ç': 't', '—É': 'u', '—Ñ': 'f', '—Ö': 'kh', '—Ü': 'ts', '—á': 'ch',
        '—à': 'sh', '—â': 'shch', '—å': '', '—é': 'yu', '—è': 'ya', '—ã': 'y', '—ç': 'e',
        '—ë': 'yo', '—ä': ''
    };
    
    let result = text.toLowerCase();
    for (const [ukr, lat] of Object.entries(map)) {
        result = result.replace(new RegExp(ukr, 'g'), lat);
    }
    result = result.replace(/[^a-z0-9\-]/g, '-');
    result = result.replace(/-+/g, '-');
    result = result.replace(/^-|-$/g, '');
    return result.substring(0, 200);
}

// –ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –ø–µ—Ä–µ–≥–ª—è–¥ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è
document.getElementById('featured_image').addEventListener('input', function() {
    const url = this.value;
    const preview = document.getElementById('imagePreview');
    if (url) {
        preview.innerHTML = `<img src="${url}" alt="Preview" onerror="this.onerror=null;this.parentElement.innerHTML='<div class=\\'preview-placeholder\\'>‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è</div>';">`;
    } else {
        preview.innerHTML = '<div class="preview-placeholder">üñº –ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –ø–µ—Ä–µ–≥–ª—è–¥</div>';
    }
});

// –õ—ñ—á–∏–ª—å–Ω–∏–∫–∏ —Å–∏–º–≤–æ–ª—ñ–≤
document.getElementById('meta_title').addEventListener('input', function() {
    document.getElementById('meta-title-count').textContent = this.value.length;
});

document.getElementById('meta_description').addEventListener('input', function() {
    document.getElementById('meta-desc-count').textContent = this.value.length;
});

// AI –≥–µ–Ω–µ—Ä–∞—Ü—ñ—è
async function generateWithAI() {
    const topic = document.getElementById('ai_topic').value || document.getElementById('title').value;
    if (!topic) {
        alert('–í–≤–µ–¥—ñ—Ç—å —Ç–µ–º—É –∞–±–æ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó');
        return;
    }
    
    const progress = document.getElementById('aiProgress');
    progress.style.display = 'flex';
    
    try {
        const response = await fetch('/api/blog/generate', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                topic: topic,
                keywords: document.getElementById('meta_keywords').value
            })
        });
        
        const data = await response.json();
        
        if (data.success) {
            if (data.title) document.getElementById('title').value = data.title;
            if (data.content) document.getElementById('content').value = data.content;
            if (data.excerpt) document.getElementById('excerpt').value = data.excerpt;
            if (data.meta_title) document.getElementById('meta_title').value = data.meta_title;
            if (data.meta_description) document.getElementById('meta_description').value = data.meta_description;
            if (data.tags) document.getElementById('tags').value = data.tags;
            generateSlug();
        } else {
            alert(data.error || '–ü–æ–º–∏–ª–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü—ñ—ó');
        }
    } catch (e) {
        alert('–ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è: ' + e.message);
    } finally {
        progress.style.display = 'none';
    }
}

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–π –ø–µ—Ä–µ–∫–ª–∞–¥ —Å—Ç–∞—Ç—Ç—ñ
async function translatePost() {
    {% if post and post.id %}
    const postId = {{ post.id }};
    {% else %}
    alert('–°–ø–æ—á–∞—Ç–∫—É –∑–±–µ—Ä–µ–∂—ñ—Ç—å —Å—Ç–∞—Ç—Ç—é');
    return;
    {% endif %}
    
    const progress = document.getElementById('translateProgress');
    const result = document.getElementById('translateResult');
    progress.style.display = 'flex';
    result.style.display = 'none';
    
    try {
        const response = await fetch(`/api/blog/translate/${postId}`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                languages: ['en', 'de']
            })
        });
        
        const data = await response.json();
        
        if (data.success) {
            result.style.display = 'block';
            result.innerHTML = `‚úÖ ${data.message}<br>`;
            
            // –û–Ω–æ–≤–ª—é—î–º–æ –ø–æ–ª—è –≤ —Ñ–æ—Ä–º—ñ
            if (data.translated.en) {
                document.getElementById('title_en').value = data.translated.en.title || '';
                document.getElementById('excerpt_en').value = data.translated.en.excerpt || '';
                // –û—Ç—Ä–∏–º—É—î–º–æ –ø–æ–≤–Ω–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç –∑ —Å–µ—Ä–≤–µ—Ä–∞
                location.reload();
            }
            if (data.translated.de) {
                document.getElementById('title_de').value = data.translated.de.title || '';
                document.getElementById('excerpt_de').value = data.translated.de.excerpt || '';
            }
            
            setTimeout(() => location.reload(), 1500);
        } else {
            alert(data.error || '–ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ–∫–ª–∞–¥—É');
        }
    } catch (e) {
        alert('–ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è: ' + e.message);
    } finally {
        progress.style.display = 'none';
    }
}

// –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –ª—ñ—á–∏–ª—å–Ω–∏–∫—ñ–≤
document.addEventListener('DOMContentLoaded', function() {
    document.getElementById('meta-title-count').textContent = document.getElementById('meta_title').value.length;
    document.getElementById('meta-desc-count').textContent = document.getElementById('meta_description').value.length;
    
    // Language tabs switching
    document.querySelectorAll('.lang-tab').forEach(tab => {
        tab.addEventListener('click', function() {
            const lang = this.dataset.lang;
            document.querySelectorAll('.lang-tab').forEach(t => t.classList.remove('active'));
            this.classList.add('active');
            document.querySelectorAll('.lang-content').forEach(c => {
                c.style.display = c.dataset.lang === lang ? 'block' : 'none';
            });
        });
    });
});
</script>
{% endblock %}
