{% extends 'admin/layout.html' %}
{% block title %}–ë–ª–æ–≥ - –ê–¥–º—ñ–Ω –ø–∞–Ω–µ–ª—å{% endblock %}
{% block content %}
<div class="page-header">
    <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:1rem;">
        <div>
            <h1>üìù –ë–ª–æ–≥</h1>
            <p class="page-subtitle">–£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è –ø—É–±–ª—ñ–∫–∞—Ü—ñ—è–º–∏ —Ç–∞ –∫–æ–Ω—Ç–µ–Ω—Ç-–ø–ª–∞–Ω–æ–º</p>
        </div>
        <div style="display:flex;gap:0.75rem;">
            <a href="{{ url_for('admin_blog_plan') }}" class="btn btn-secondary">üìÖ –ü–ª–∞–Ω –Ω–∞ 7 –¥–Ω—ñ–≤</a>
            <a href="{{ url_for('admin_blog_new') }}" class="btn btn-primary">‚ûï –ù–æ–≤–∞ —Å—Ç–∞—Ç—Ç—è</a>
        </div>
    </div>
</div>

<!-- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-value">{{ stats.total }}</div>
        <div class="stat-label">–í—Å—å–æ–≥–æ —Å—Ç–∞—Ç–µ–π</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{ stats.published }}</div>
        <div class="stat-label">–û–ø—É–±–ª—ñ–∫–æ–≤–∞–Ω–æ</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{ stats.scheduled }}</div>
        <div class="stat-label">–ó–∞–ø–ª–∞–Ω–æ–≤–∞–Ω–æ</div>
    </div>
    <div class="stat-card">
        <div class="stat-value">{{ stats.draft }}</div>
        <div class="stat-label">–ß–µ—Ä–Ω–µ—Ç–∫–∏</div>
    </div>
</div>

<!-- –§—ñ–ª—å—Ç—Ä–∏ -->
<div class="filters-bar">
    <div class="filter-group">
        <a href="{{ url_for('admin_blog') }}" class="filter-btn {{ 'active' if not status_filter else '' }}">–í—Å—ñ</a>
        <a href="{{ url_for('admin_blog', status='published') }}" class="filter-btn {{ 'active' if status_filter == 'published' else '' }}">–û–ø—É–±–ª—ñ–∫–æ–≤–∞–Ω—ñ</a>
        <a href="{{ url_for('admin_blog', status='scheduled') }}" class="filter-btn {{ 'active' if status_filter == 'scheduled' else '' }}">–ó–∞–ø–ª–∞–Ω–æ–≤–∞–Ω—ñ</a>
        <a href="{{ url_for('admin_blog', status='draft') }}" class="filter-btn {{ 'active' if status_filter == 'draft' else '' }}">–ß–µ—Ä–Ω–µ—Ç–∫–∏</a>
    </div>
</div>

<!-- –°–ø–∏—Å–æ–∫ –ø–æ—Å—Ç—ñ–≤ -->
<div class="card">
    <table class="data-table">
        <thead>
            <tr>
                <th>–°—Ç–∞—Ç—Ç—è</th>
                <th>–°—Ç–∞—Ç—É—Å</th>
                <th>–ê–≤—Ç–æ—Ä</th>
                <th>–î–∞—Ç–∞</th>
                <th>üëÅ –ü–µ—Ä–µ–≥–ª—è–¥–∏</th>
                <th>–î—ñ—ó</th>
            </tr>
        </thead>
        <tbody>
            {% if posts %}
                {% for post in posts %}
                <tr>
                    <td>
                        <div class="post-info">
                            {% if post.featured_image %}
                            <img src="{{ post.featured_image }}" alt="" class="post-thumb">
                            {% else %}
                            <div class="post-thumb-placeholder">üìÑ</div>
                            {% endif %}
                            <div>
                                <a href="{{ url_for('admin_blog_edit', id=post.id) }}" class="post-title">{{ post.title }}</a>
                                {% if post.is_ai_generated %}
                                <span class="ai-badge">ü§ñ AI</span>
                                {% endif %}
                                <div class="post-meta">
                                    {% if post.tags_list %}
                                    {% for tag in post.tags_list[:3] %}
                                    <span class="tag">{{ tag }}</span>
                                    {% endfor %}
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </td>
                    <td>
                        {% if post.status == 'published' %}
                        <span class="status-badge success">‚úì –û–ø—É–±–ª—ñ–∫–æ–≤–∞–Ω–æ</span>
                        {% elif post.status == 'scheduled' %}
                        <span class="status-badge warning">üïê –ó–∞–ø–ª–∞–Ω–æ–≤–∞–Ω–æ</span>
                        {% elif post.status == 'draft' %}
                        <span class="status-badge neutral">üìù –ß–µ—Ä–Ω–µ—Ç–∫–∞</span>
                        {% else %}
                        <span class="status-badge">{{ post.status }}</span>
                        {% endif %}
                    </td>
                    <td>{{ post.author or 'AI' }}</td>
                    <td>
                        {% if post.publish_date %}
                        {{ post.publish_date.strftime('%d.%m.%Y %H:%M') }}
                        {% else %}
                        ‚Äî
                        {% endif %}
                    </td>
                    <td>{{ post.views or 0 }}</td>
                    <td>
                        <div class="actions">
                            {% if post.status != 'published' %}
                            <form method="post" action="{{ url_for('admin_blog_publish', id=post.id) }}" style="display:inline;">
                                <button type="submit" class="btn-icon success" title="–û–ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏">üöÄ</button>
                            </form>
                            {% endif %}
                            <button type="button" class="btn-icon translate-btn" data-id="{{ post.id }}" title="–ê–≤—Ç–æ–ø–µ—Ä–µ–∫–ª–∞–¥ EN+DE" onclick="translatePost({{ post.id }}, this)">
                                üåê
                            </button>
                            <a href="{{ url_for('blog_post_page', slug=post.slug) }}" target="_blank" class="btn-icon" title="–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏">üëÅ</a>
                            <a href="{{ url_for('admin_blog_edit', id=post.id) }}" class="btn-icon" title="–†–µ–¥–∞–≥—É–≤–∞—Ç–∏">‚úèÔ∏è</a>
                            <form method="post" action="{{ url_for('admin_blog_delete', id=post.id) }}" style="display:inline;">
                                <button type="submit" class="btn-icon danger" title="–í–∏–¥–∞–ª–∏—Ç–∏" onclick="return confirm('–í–∏–¥–∞–ª–∏—Ç–∏ —Ü—é —Å—Ç–∞—Ç—Ç—é?')">üóë</button>
                            </form>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            {% else %}
            <tr>
                <td colspan="6" class="empty-state">
                    <div class="empty-icon">üìù</div>
                    <p>–©–µ –Ω–µ–º–∞—î –∂–æ–¥–Ω–æ—ó —Å—Ç–∞—Ç—Ç—ñ</p>
                    <a href="{{ url_for('admin_blog_new') }}" class="btn btn-primary">–°—Ç–≤–æ—Ä–∏—Ç–∏ –ø–µ—Ä—à—É —Å—Ç–∞—Ç—Ç—é</a>
                </td>
            </tr>
            {% endif %}
        </tbody>
    </table>
</div>

<!-- –ü–∞–≥—ñ–Ω–∞—Ü—ñ—è -->
{% if total_pages > 1 %}
<div class="pagination">
    {% for p in range(1, total_pages + 1) %}
    <a href="{{ url_for('admin_blog', page=p, status=status_filter) }}" class="page-btn {{ 'active' if p == page else '' }}">{{ p }}</a>
    {% endfor %}
</div>
{% endif %}

<style>
.stats-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1rem;
    margin-bottom: 1.5rem;
}

.stat-card {
    background: rgba(15, 23, 42, 0.9);
    border: 1px solid rgba(148, 163, 184, 0.3);
    border-radius: 1rem;
    padding: 1.25rem;
    text-align: center;
}

.stat-value {
    font-size: 2rem;
    font-weight: 700;
    color: var(--accent);
}

.stat-label {
    font-size: 0.85rem;
    color: var(--text-muted);
}

.filters-bar {
    display: flex;
    gap: 1rem;
    margin-bottom: 1rem;
}

.filter-btn {
    padding: 0.5rem 1rem;
    border-radius: 999px;
    background: rgba(148, 163, 184, 0.1);
    color: var(--text-muted);
    font-size: 0.85rem;
    text-decoration: none;
    transition: all 0.2s;
}

.filter-btn:hover, .filter-btn.active {
    background: rgba(16, 185, 129, 0.15);
    color: var(--accent);
}

.post-info {
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.post-thumb {
    width: 48px;
    height: 48px;
    border-radius: 0.5rem;
    object-fit: cover;
}

.post-thumb-placeholder {
    width: 48px;
    height: 48px;
    border-radius: 0.5rem;
    background: rgba(148, 163, 184, 0.2);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
}

.post-title {
    font-weight: 600;
    color: var(--text-main);
    text-decoration: none;
}

.post-title:hover {
    color: var(--accent);
}

.ai-badge {
    font-size: 0.7rem;
    padding: 0.15rem 0.4rem;
    background: rgba(168, 85, 247, 0.2);
    color: #a855f7;
    border-radius: 0.25rem;
    margin-left: 0.5rem;
}

.post-meta {
    display: flex;
    gap: 0.35rem;
    margin-top: 0.25rem;
}

.tag {
    font-size: 0.7rem;
    padding: 0.15rem 0.4rem;
    background: rgba(148, 163, 184, 0.15);
    color: var(--text-muted);
    border-radius: 0.25rem;
}

.status-badge {
    font-size: 0.75rem;
    padding: 0.25rem 0.6rem;
    border-radius: 999px;
    background: rgba(148, 163, 184, 0.2);
}

.status-badge.success {
    background: rgba(34, 197, 94, 0.2);
    color: #22c55e;
}

.status-badge.warning {
    background: rgba(234, 179, 8, 0.2);
    color: #eab308;
}

.status-badge.neutral {
    background: rgba(148, 163, 184, 0.2);
    color: var(--text-muted);
}

.actions {
    display: flex;
    gap: 0.5rem;
}

.btn-icon {
    padding: 0.35rem 0.5rem;
    border: none;
    background: rgba(148, 163, 184, 0.1);
    border-radius: 0.35rem;
    cursor: pointer;
    transition: background 0.2s;
}

.btn-icon:hover {
    background: rgba(148, 163, 184, 0.2);
}

.btn-icon.success:hover {
    background: rgba(34, 197, 94, 0.2);
}

.btn-icon.danger:hover {
    background: rgba(239, 68, 68, 0.2);
}

.empty-state {
    text-align: center;
    padding: 3rem;
}

.empty-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
}

.pagination {
    display: flex;
    justify-content: center;
    gap: 0.5rem;
    margin-top: 1.5rem;
}

.page-btn {
    padding: 0.5rem 0.75rem;
    border-radius: 0.5rem;
    background: rgba(148, 163, 184, 0.1);
    color: var(--text-muted);
    text-decoration: none;
}

.page-btn:hover, .page-btn.active {
    background: var(--accent);
    color: white;
}

.translate-btn {
    position: relative;
}

.translate-btn.loading::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 14px;
    height: 14px;
    margin: -7px 0 0 -7px;
    border: 2px solid rgba(16, 185, 129, 0.3);
    border-top-color: #10b981;
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
}

.translate-btn.loading {
    color: transparent;
}

.translate-btn.done {
    background: rgba(34, 197, 94, 0.2);
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

@media (max-width: 768px) {
    .stats-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}
</style>

<script>
async function translatePost(postId, btn) {
    if (btn.classList.contains('loading')) return;
    
    btn.classList.add('loading');
    
    try {
        const response = await fetch(`/api/blog/translate/${postId}`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ languages: ['en', 'de'] })
        });
        
        const data = await response.json();
        
        if (data.success) {
            btn.classList.remove('loading');
            btn.classList.add('done');
            btn.innerHTML = '‚úÖ';
            btn.title = '–ü–µ—Ä–µ–∫–ª–∞–¥–µ–Ω–æ!';
        } else {
            btn.classList.remove('loading');
            alert(data.error || '–ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ–∫–ª–∞–¥—É');
        }
    } catch (e) {
        btn.classList.remove('loading');
        alert('–ü–æ–º–∏–ª–∫–∞: ' + e.message);
    }
}
</script>
{% endblock %}
